#!/bin/bash
set -u 
set -e 

echo -e "run get_mapped_bed.pl\n"
perl get_mapped_bed.pl 20191219-UNL085-P5-PAE34153.fa.bam.infor 20191219-UNL085-P5-PAE34153.mapped.bed 20191219-UNL085-P5-PAE34153.maybemapped.bed &
perl get_mapped_bed.pl 20191230-UNL085-P1-PAE32963.fa.bam.infor 20191230-UNL085-P1-PAE32963.mapped.bed 20191230-UNL085-P1-PAE32963.maybemapped.bed &
perl get_mapped_bed.pl 20191231-UNL085-P1-PAE32963.fa.bam.infor 20191231-UNL085-P1-PAE32963.mapped.bed 20191231-UNL085-P1-PAE32963.maybemapped.bed &
perl get_mapped_bed.pl 20200117-UNL085-P5-PAE39466.fa.bam.infor 20200117-UNL085-P5-PAE39466.mapped.bed 20200117-UNL085-P5-PAE39466.maybemapped.bed &
perl get_mapped_bed.pl 20200118-UNL085-P5-PAE39466.fa.bam.infor 20200118-UNL085-P5-PAE39466.mapped.bed 20200118-UNL085-P5-PAE39466.maybemapped.bed &
perl get_mapped_bed.pl 20200312-UNL085-P1-PAE30600.fa.bam.infor 20200312-UNL085-P1-PAE30600.mapped.bed 20200312-UNL085-P1-PAE30600.maybemapped.bed &
perl get_mapped_bed.pl 20200313-UNL085-P1-PAE30600.fa.bam.infor 20200313-UNL085-P1-PAE30600.mapped.bed 20200313-UNL085-P1-PAE30600.maybemapped.bed &
perl get_mapped_bed.pl 20200328-UNL085-P1-PAE78052.fa.bam.infor 20200328-UNL085-P1-PAE78052.mapped.bed 20200328-UNL085-P1-PAE78052.maybemapped.bed &
perl get_mapped_bed.pl 20200329-UNL085-P1-PAE78052.fa.bam.infor 20200329-UNL085-P1-PAE78052.mapped.bed 20200329-UNL085-P1-PAE78052.maybemapped.bed &
perl get_mapped_bed.pl 20200330-UNL085-P1-PAE72324.fa.bam.infor 20200330-UNL085-P1-PAE72324.mapped.bed 20200330-UNL085-P1-PAE72324.maybemapped.bed &
perl get_mapped_bed.pl 20200330-UNL085-P1-PAE73001.fa.bam.infor 20200330-UNL085-P1-PAE73001.mapped.bed 20200330-UNL085-P1-PAE73001.maybemapped.bed &
perl get_mapped_bed.pl 20200330-UNL085-P1-PAE74959.fa.bam.infor 20200330-UNL085-P1-PAE74959.mapped.bed 20200330-UNL085-P1-PAE74959.maybemapped.bed &
perl get_mapped_bed.pl 20200331-UNL085-P1-PAE73476.fa.bam.infor 20200331-UNL085-P1-PAE73476.mapped.bed 20200331-UNL085-P1-PAE73476.maybemapped.bed &
perl get_mapped_bed.pl 20200331-UNL085-P1-PAE76301.fa.bam.infor 20200331-UNL085-P1-PAE76301.mapped.bed 20200331-UNL085-P1-PAE76301.maybemapped.bed &
perl get_mapped_bed.pl 20200331-UNL085-P1-PAE76304.fa.bam.infor 20200331-UNL085-P1-PAE76304.mapped.bed 20200331-UNL085-P1-PAE76304.maybemapped.bed &
perl get_mapped_bed.pl 20200331-UNL085-P1-PAE77443.fa.bam.infor 20200331-UNL085-P1-PAE77443.mapped.bed 20200331-UNL085-P1-PAE77443.maybemapped.bed &
perl get_mapped_bed.pl 20200402-UNL085-P1-PAE66442.fa.bam.infor 20200402-UNL085-P1-PAE66442.mapped.bed 20200402-UNL085-P1-PAE66442.maybemapped.bed &
perl get_mapped_bed.pl 20200403-UNL085-P1-PAE59748.fa.bam.infor 20200403-UNL085-P1-PAE59748.mapped.bed 20200403-UNL085-P1-PAE59748.maybemapped.bed &
perl get_mapped_bed.pl 20200403-UNL085-P1-PAE63133.fa.bam.infor 20200403-UNL085-P1-PAE63133.mapped.bed 20200403-UNL085-P1-PAE63133.maybemapped.bed &
perl get_mapped_bed.pl 20200403-UNL085-P1-PAE65508.fa.bam.infor 20200403-UNL085-P1-PAE65508.mapped.bed 20200403-UNL085-P1-PAE65508.maybemapped.bed &
perl get_mapped_bed.pl 20200404-UNL085-P1-PAE58899.fa.bam.infor 20200404-UNL085-P1-PAE58899.mapped.bed 20200404-UNL085-P1-PAE58899.maybemapped.bed &
perl get_mapped_bed.pl 20200404-UNL085-P1-PAE59636.fa.bam.infor 20200404-UNL085-P1-PAE59636.mapped.bed 20200404-UNL085-P1-PAE59636.maybemapped.bed &
perl get_mapped_bed.pl 20200404-UNL085-P1-PAE62586.fa.bam.infor 20200404-UNL085-P1-PAE62586.mapped.bed 20200404-UNL085-P1-PAE62586.maybemapped.bed &
perl get_mapped_bed.pl 20200404-UNL085-P1-PAE63133.fa.bam.infor 20200404-UNL085-P1-PAE63133.mapped.bed 20200404-UNL085-P1-PAE63133.maybemapped.bed &
perl get_mapped_bed.pl 20200404-UNL085-P1-PAE64841.fa.bam.infor 20200404-UNL085-P1-PAE64841.mapped.bed 20200404-UNL085-P1-PAE64841.maybemapped.bed &
perl get_mapped_bed.pl 20200405-UNL085-P1-PAE55943.fa.bam.infor 20200405-UNL085-P1-PAE55943.mapped.bed 20200405-UNL085-P1-PAE55943.maybemapped.bed &
perl get_mapped_bed.pl 20200405-UNL085-P1-PAE58455.fa.bam.infor 20200405-UNL085-P1-PAE58455.mapped.bed 20200405-UNL085-P1-PAE58455.maybemapped.bed &
perl get_mapped_bed.pl 20200405-UNL085-P1-PAE59610.fa.bam.infor 20200405-UNL085-P1-PAE59610.mapped.bed 20200405-UNL085-P1-PAE59610.maybemapped.bed &
perl get_mapped_bed.pl 20200405-UNL085-P1-PAE64851.fa.bam.infor 20200405-UNL085-P1-PAE64851.mapped.bed 20200405-UNL085-P1-PAE64851.maybemapped.bed &
perl get_mapped_bed.pl 20200405-UNL085-P1-PAE69208.fa.bam.infor 20200405-UNL085-P1-PAE69208.mapped.bed 20200405-UNL085-P1-PAE69208.maybemapped.bed &
perl get_mapped_bed.pl 20200405-UNL085-P1-PAE69448.fa.bam.infor 20200405-UNL085-P1-PAE69448.mapped.bed 20200405-UNL085-P1-PAE69448.maybemapped.bed &
perl get_mapped_bed.pl 20200406-UNL085-P1-PAE69448.fa.bam.infor 20200406-UNL085-P1-PAE69448.mapped.bed 20200406-UNL085-P1-PAE69448.maybemapped.bed &
perl get_mapped_bed.pl 20200406-UNL085-P5-PAE70217.fa.bam.infor 20200406-UNL085-P5-PAE70217.mapped.bed 20200406-UNL085-P5-PAE70217.maybemapped.bed &
perl get_mapped_bed.pl 20200407-UNL085-P5-PAE66590.fa.bam.infor 20200407-UNL085-P5-PAE66590.mapped.bed 20200407-UNL085-P5-PAE66590.maybemapped.bed &
perl get_mapped_bed.pl 20200408-UNL085-P5-PAE69418.fa.bam.infor 20200408-UNL085-P5-PAE69418.mapped.bed 20200408-UNL085-P5-PAE69418.maybemapped.bed &
perl get_mapped_bed.pl 20200409-UNL085-P5-PAE46763.fa.bam.infor 20200409-UNL085-P5-PAE46763.mapped.bed 20200409-UNL085-P5-PAE46763.maybemapped.bed &
wait

echo -e "combine all cell .bed files\n"
cat \
20191219-UNL085-P5-PAE34153.mapped.bed \
20191230-UNL085-P1-PAE32963.mapped.bed \
20191231-UNL085-P1-PAE32963.mapped.bed \
20200117-UNL085-P5-PAE39466.mapped.bed \
20200118-UNL085-P5-PAE39466.mapped.bed \
20200312-UNL085-P1-PAE30600.mapped.bed \
20200313-UNL085-P1-PAE30600.mapped.bed \
20200328-UNL085-P1-PAE78052.mapped.bed \
20200329-UNL085-P1-PAE78052.mapped.bed \
20200330-UNL085-P1-PAE72324.mapped.bed \
20200330-UNL085-P1-PAE73001.mapped.bed \
20200330-UNL085-P1-PAE74959.mapped.bed \
20200331-UNL085-P1-PAE73476.mapped.bed \
20200331-UNL085-P1-PAE76301.mapped.bed \
20200331-UNL085-P1-PAE76304.mapped.bed \
20200331-UNL085-P1-PAE77443.mapped.bed \
20200402-UNL085-P1-PAE66442.mapped.bed \
20200403-UNL085-P1-PAE59748.mapped.bed \
20200403-UNL085-P1-PAE63133.mapped.bed \
20200403-UNL085-P1-PAE65508.mapped.bed \
20200404-UNL085-P1-PAE58899.mapped.bed \
20200404-UNL085-P1-PAE59636.mapped.bed \
20200404-UNL085-P1-PAE62586.mapped.bed \
20200404-UNL085-P1-PAE63133.mapped.bed \
20200404-UNL085-P1-PAE64841.mapped.bed \
20200405-UNL085-P1-PAE55943.mapped.bed \
20200405-UNL085-P1-PAE58455.mapped.bed \
20200405-UNL085-P1-PAE59610.mapped.bed \
20200405-UNL085-P1-PAE64851.mapped.bed \
20200405-UNL085-P1-PAE69208.mapped.bed \
20200405-UNL085-P1-PAE69448.mapped.bed \
20200406-UNL085-P1-PAE69448.mapped.bed \
20200406-UNL085-P5-PAE70217.mapped.bed \
20200407-UNL085-P5-PAE66590.mapped.bed \
20200408-UNL085-P5-PAE69418.mapped.bed \
20200409-UNL085-P5-PAE46763.mapped.bed \
| sort -k1,1 -k2,2n - > allCellMapped.bed &

cat \
20191219-UNL085-P5-PAE34153.maybemapped.bed \
20191230-UNL085-P1-PAE32963.maybemapped.bed \
20191231-UNL085-P1-PAE32963.maybemapped.bed \
20200117-UNL085-P5-PAE39466.maybemapped.bed \
20200118-UNL085-P5-PAE39466.maybemapped.bed \
20200312-UNL085-P1-PAE30600.maybemapped.bed \
20200313-UNL085-P1-PAE30600.maybemapped.bed \
20200328-UNL085-P1-PAE78052.maybemapped.bed \
20200329-UNL085-P1-PAE78052.maybemapped.bed \
20200330-UNL085-P1-PAE72324.maybemapped.bed \
20200330-UNL085-P1-PAE73001.maybemapped.bed \
20200330-UNL085-P1-PAE74959.maybemapped.bed \
20200331-UNL085-P1-PAE73476.maybemapped.bed \
20200331-UNL085-P1-PAE76301.maybemapped.bed \
20200331-UNL085-P1-PAE76304.maybemapped.bed \
20200331-UNL085-P1-PAE77443.maybemapped.bed \
20200402-UNL085-P1-PAE66442.maybemapped.bed \
20200403-UNL085-P1-PAE59748.maybemapped.bed \
20200403-UNL085-P1-PAE63133.maybemapped.bed \
20200403-UNL085-P1-PAE65508.maybemapped.bed \
20200404-UNL085-P1-PAE58899.maybemapped.bed \
20200404-UNL085-P1-PAE59636.maybemapped.bed \
20200404-UNL085-P1-PAE62586.maybemapped.bed \
20200404-UNL085-P1-PAE63133.maybemapped.bed \
20200404-UNL085-P1-PAE64841.maybemapped.bed \
20200405-UNL085-P1-PAE55943.maybemapped.bed \
20200405-UNL085-P1-PAE58455.maybemapped.bed \
20200405-UNL085-P1-PAE59610.maybemapped.bed \
20200405-UNL085-P1-PAE64851.maybemapped.bed \
20200405-UNL085-P1-PAE69208.maybemapped.bed \
20200405-UNL085-P1-PAE69448.maybemapped.bed \
20200406-UNL085-P1-PAE69448.maybemapped.bed \
20200406-UNL085-P5-PAE70217.maybemapped.bed \
20200407-UNL085-P5-PAE66590.maybemapped.bed \
20200408-UNL085-P5-PAE69418.maybemapped.bed \
20200409-UNL085-P5-PAE46763.maybemapped.bed \
| sort -k1,1 -k2,2n - > allCellMaybeMapped.bed &
wait

rm *.maybemapped.bed *.mapped.bed


echo -e "run bedtools genomecov\n"
bedtools genomecov -i allCellMapped.bed      -g /public1/home/sc30797/wangzijian/update_Mo17/02_fill_gap/08_final_fill/Mo17.final.polish.fa.len -bga -split > Mo17.final.polish.fa.filtered.depth.bed
bedtools genomecov -i allCellMaybeMapped.bed -g /public1/home/sc30797/wangzijian/update_Mo17/02_fill_gap/08_final_fill/Mo17.final.polish.fa.len -bga -split > Mo17.final.polish.fa.original.depth.bed