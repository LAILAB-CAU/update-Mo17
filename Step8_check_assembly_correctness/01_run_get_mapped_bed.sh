#!/bin/bash
set -u 
set -e 

echo -e "run get_mapped_bed.pl\n"
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200404-UNL085-P1-PAE58899.pass.fastq.bam.infor 20200404-UNL085-P1-PAE58899.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200404-UNL085-P1-PAE64841.pass.fastq.bam.infor 20200404-UNL085-P1-PAE64841.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200403-UNL085-P1-PAE59748.pass.fastq.bam.infor 20200403-UNL085-P1-PAE59748.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200405-UNL085-P1-PAE69208.pass.fastq.bam.infor 20200405-UNL085-P1-PAE69208.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200328-UNL085-P1-PAE78052-hac.pass.fastq.bam.infor 20200328-UNL085-P1-PAE78052.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200330-UNL085-P1-PAE73001.pass.fastq.bam.infor 20200330-UNL085-P1-PAE73001.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200405-UNL085-P1-PAE59610.pass.fastq.bam.infor 20200405-UNL085-P1-PAE59610.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200402-UNL085-P1-PAE66442.pass.fastq.bam.infor 20200402-UNL085-P1-PAE66442.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200330-UNL085-P1-PAE72324.pass.fastq.bam.infor 20200330-UNL085-P1-PAE72324.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200404-UNL085-P1-PAE62586.pass.fastq.bam.infor 20200404-UNL085-P1-PAE62586.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200331-UNL085-P1-PAE77443.pass.fastq.bam.infor 20200331-UNL085-P1-PAE77443.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200405-UNL085-P1-PAE69448.pass.fastq.bam.infor 20200405-UNL085-P1-PAE69448.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200331-UNL085-P1-PAE76304.pass.fastq.bam.infor 20200331-UNL085-P1-PAE76304.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200330-UNL085-P1-PAE74959.pass.fastq.bam.infor 20200330-UNL085-P1-PAE74959.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200117-UNL085-P5-PAE39466-hac.pass.fastq.bam.infor 20200117-UNL085-P5-PAE39466.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200331-UNL085-P1-PAE73476.pass.fastq.bam.infor 20200331-UNL085-P1-PAE73476.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200331-UNL085-P1-PAE76301.pass.fastq.bam.infor 20200331-UNL085-P1-PAE76301.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200404-UNL085-P1-PAE59636.pass.fastq.bam.infor 20200404-UNL085-P1-PAE59636.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200407-UNL085-P5-PAE66590.pass.fastq.bam.infor 20200407-UNL085-P5-PAE66590.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20191230-UNL085-P1-PAE32963-hac.pass.fastq.bam.infor 20191230-UNL085-P1-PAE32963.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200409-UNL085-P5-PAE46763.pass.fastq.bam.infor 20200409-UNL085-P5-PAE46763.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200406-UNL085-P5-PAE70217.pass.fastq.bam.infor 20200406-UNL085-P5-PAE70217.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200312-UNL085-P1-PAE30600.pass.fastq.bam.infor 20200312-UNL085-P1-PAE30600.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20191219-UNL085-P5-PAE34153-hac.pass.fastq.bam.infor 20191219-UNL085-P5-PAE34153.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200405-UNL085-P1-PAE64851.pass.fastq.bam.infor 20200405-UNL085-P1-PAE64851.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200408-UNL085-P5-PAE69418.pass.fastq.bam.infor 20200408-UNL085-P5-PAE69418.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200403-UNL085-P1-PAE63133.pass.fastq.bam.infor 20200403-UNL085-P1-PAE63133.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200405-UNL085-P1-PAE58455.pass.fastq.bam.infor 20200405-UNL085-P1-PAE58455.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200313-UNL085-P1-PAE30600.pass.fastq.bam.infor 20200313-UNL085-P1-PAE30600.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200329-UNL085-P1-PAE78052-hac.pass.fastq.bam.infor 20200329-UNL085-P1-PAE78052.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200406-UNL085-P1-PAE69448.pass.fastq.bam.infor 20200406-UNL085-P1-PAE69448.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200404-UNL085-P1-PAE63133.pass.fastq.bam.infor 20200404-UNL085-P1-PAE63133.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20191231-UNL085-P1-PAE32963-hac.pass.fastq.bam.infor 20191231-UNL085-P1-PAE32963.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200403-UNL085-P1-PAE65508.pass.fastq.bam.infor 20200403-UNL085-P1-PAE65508.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200118-UNL085-P5-PAE39466-hac.pass.fastq.bam.infor 20200118-UNL085-P5-PAE39466.bed &
perl get_mapped_bed.pl /public1/home/sc30797/wangzijian/update_Mo17/Step4_local_assembly/nanopore_minimap2/20200405-UNL085-P1-PAE55943.pass.fastq.bam.infor 20200405-UNL085-P1-PAE55943.bed &
wait

echo -e "combine all cell .bed files\n"
cat \
20200404-UNL085-P1-PAE58899.bed \
20200404-UNL085-P1-PAE64841.bed \
20200403-UNL085-P1-PAE59748.bed \
20200405-UNL085-P1-PAE69208.bed \
20200328-UNL085-P1-PAE78052.bed \
20200330-UNL085-P1-PAE73001.bed \
20200405-UNL085-P1-PAE59610.bed \
20200402-UNL085-P1-PAE66442.bed \
20200330-UNL085-P1-PAE72324.bed \
20200404-UNL085-P1-PAE62586.bed \
20200331-UNL085-P1-PAE77443.bed \
20200405-UNL085-P1-PAE69448.bed \
20200331-UNL085-P1-PAE76304.bed \
20200330-UNL085-P1-PAE74959.bed \
20200117-UNL085-P5-PAE39466.bed \
20200331-UNL085-P1-PAE73476.bed \
20200331-UNL085-P1-PAE76301.bed \
20200404-UNL085-P1-PAE59636.bed \
20200407-UNL085-P5-PAE66590.bed \
20191230-UNL085-P1-PAE32963.bed \
20200409-UNL085-P5-PAE46763.bed \
20200406-UNL085-P5-PAE70217.bed \
20200312-UNL085-P1-PAE30600.bed \
20191219-UNL085-P5-PAE34153.bed \
20200405-UNL085-P1-PAE64851.bed \
20200408-UNL085-P5-PAE69418.bed \
20200403-UNL085-P1-PAE63133.bed \
20200405-UNL085-P1-PAE58455.bed \
20200313-UNL085-P1-PAE30600.bed \
20200329-UNL085-P1-PAE78052.bed \
20200406-UNL085-P1-PAE69448.bed \
20200404-UNL085-P1-PAE63133.bed \
20191231-UNL085-P1-PAE32963.bed \
20200403-UNL085-P1-PAE65508.bed \
20200118-UNL085-P5-PAE39466.bed \
20200405-UNL085-P1-PAE55943.bed \
| sort -k1,1 -k2,2n - > allCellMapped.bed

echo -e "run bedtools genomecov\n"
bedtools genomecov -i allCellMapped.bed -g ~/wangzijian/update_Mo17/00_assembly/merge_nanopore_pacbio/Mo17.almostComplete.fa.len -bga -split > Mo17.almostComplete.fa.depth.bed
